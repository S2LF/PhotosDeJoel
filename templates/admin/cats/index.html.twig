{% extends 'base.html.twig' %}

{% block title %}Les Photos de Joël | Admin - Catégories{% endblock %}

{% block body %}



<h1 class="center">Espace Admin</h1>

{% include "admin/adminNav.html.twig" %}

<h2 class="center">Gestions des catégories</h2>

{% if cats == null %}
    <h3>Pas de catégorie</h3>
{% else %}  

    <section class="draggable flex center">
        {% for cat in cats %}
            <article data-id="{{cat.id}}">
                <a href="{{ path('admin_cat_photos', {'id':cat.id}) }}">
                <h3>{{ cat.titre }}
                    <a href="{{ path('admin_edit_cat', {'id':cat.id})}}"><i class="fas fa-pen-square"></i></a></h3></a>
                    <a href="{{ path('admin_cat_photos', {'id':cat.id}) }}">
                        {% set ps = cat.photos|sort((a, b) => a.position <=> b.position )%}
                        
                        {% if ps != null %}
                        {% set p = ps|first %}
                        <img style="width: 100px" src="{{ asset('img/' ~ p.path ) }}" alt="{{ cat.titre }}">
                        {% else %}
                        <img style="width: 100px" src="{{ asset('img/default/Default.png' ) }}" alt="{{ cat.titre }}">
                        {% endif %}
                </a>
            </article>
        {% endfor %}
    </section>
{% endif %}

    <p><a href="{{ path('admin_add_cat')}}">Ajouter une catégorie</a></p>

{% endblock %}

{% block javascripts %}
{{ parent() }}

<script>
  jQuery('.draggable').sortable({
    stop:function(event, ui){
      let id = ui.item.attr('data-id')
      console.log("id:"+id)
      let position = ui.item.index()
      console.log("pos:"+position)
      $.post(
        "{{ path('admin_cat_sort') }}",
        {
          'cat_id': id,
          'position': position
        },
        function(data){
          console.log(data)
        }
      )
    }
  })
</script>
{% endblock %}